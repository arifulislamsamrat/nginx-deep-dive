# Workers & Connections Bangla

### NGINX কনফিগারেশনের মাধ্যমে সার্ভারের পারফরম্যান্স সামঞ্জস্য করা

এই ভিডিওতে আমরা আলোচনা করবো কিভাবে আমরা `worker_processes`, `worker_connections` এবং পরে কিপএলাইভ (keepalives) পরিবর্তন করে আমাদের সার্ভারের পারফরম্যান্স সামঞ্জস্য করতে পারি। শুরু করতে, আমরা `nginx.conf` খুলবো যেখানে NGINX এর প্রধান কনফিগারেশন রয়েছে এবং শীর্ষে দুটি জিনিস থাকবে। আমরা `worker_processes` পাব, যা বর্তমানে একে সেট করা আছে। এবং তারপরে আমাদের ইভেন্টস (events) কনটেক্সটের মধ্যে, আমরা `worker_connections` পাব, যা ১০২৪ এ সেট করা আছে।

এইগুলো পরিবর্তন করার আগে, আসুন দেখি এইগুলো কি করে।

### `worker_processes` কনফিগার করা

NGINX একটি মাস্টার প্রসেস হিসেবে শুরু হয়, এবং এর নিচে একাধিক `worker_processes` থাকতে পারে। `worker_processes` এর আদর্শ মান আপনার CPU কোরের সংখ্যা হবে। আপনি চাইবেন যতগুলো কোর আছে ততগুলো `worker_processes`। এটি NGINX চালানোর জন্য নিবেদিত একটি সার্ভারের জন্য।

`worker_connections` হল প্রতিটি ওয়ার্কার প্রসেসের জন্য নির্দিষ্ট সময়ে কতগুলো কানেকশন থাকতে পারে। আপনার সার্ভার এক সময়ে কতগুলো কানেকশন পরিচালনা করতে পারবে তা নির্ধারণ করতে, `worker_processes` এবং `worker_connections` কে গুণ করতে হবে। `worker_processes` এর ভারসাম্য খুঁজে পাওয়া সহজ, তবে সঠিক `worker_connections` সংখ্যা নির্ধারণ কিছুটা চেষ্টা এবং ত্রুটির প্রয়োজন।

`worker_processes` কনফিগার করতে, আপনি একটি নির্দিষ্ট সংখ্যা সেট করতে পারেন বা `auto` ব্যবহার করতে পারেন। `auto` সেটিং আপনার CPU কোর সংখ্যা সনাক্ত করবে এবং `worker_processes` অনুযায়ী সেট করবে। এটি নিশ্চিত করবে যে NGINX সর্বাধিক পারফরম্যান্সের জন্য সমস্ত উপলব্ধ CPU কোর ব্যবহার করে। আসুন `worker_processes` কে `auto` এ পরিবর্তন করি:

```bash
worker_processes auto;
```

### `worker_connections` কনফিগার করা

এখন আসুন `worker_connections` এর দিকে মনোনিবেশ করি। ডিফল্ট মান সাধারণত ৫১২, তবে আমাদের কনফিগারেশনে এটি ১০২৪ এ সেট করা আছে। আধুনিক সার্ভারগুলির জন্য এই সংখ্যা কম। NGINX এক দশকেরও বেশি সময় আগে ১০,০০০ অনুরোধ প্রতি সেকেন্ডের সমস্যার সমাধান করতে তৈরি হয়েছিল, তাই আমরা এটি উচ্চতর সেট করতে পারি। আমরা `worker_connections` কে দ্বিগুণ করে ২০৪৮ এ সেট করবো যাতে ট্রাফিক স্পাইকের সময় কানেকশন ড্রপ না হয়:

```bash
worker_connections 2048;
```

এই পরিবর্তনগুলি করার পরে, ফাইলটি সংরক্ষণ করুন এবং কোন ত্রুটি নেই তা নিশ্চিত করার জন্য সিনট্যাক্স চেক করুন:

```bash
sudo nginx -t
sudo systemctl reload nginx
```

যদি আপনি খোলা ফাইলের সংখ্যা অতিক্রম করার বিষয়ে সতর্কবার্তা পান, আপনি সিস্টেমের হার্ড লিমিটের সাথে মেলাতে `worker_rlimit_nofile` নির্দেশনা সেট করতে পারেন:

```bash
worker_rlimit_nofile 4096;
```

### কিপএলাইভ (Keepalives) কনফিগার করা

কিপএলাইভগুলি একক TCP কানেকশনকে একাধিক অনুরোধ পরিচালনা করতে দেয়, নতুন কানেকশন স্থাপনের ওভারহেড কমায়। এটি `keepalive_timeout` এবং `keepalive_requests` ব্যবহার করে কনফিগার করা হয়। ডিফল্ট `keepalive_timeout` ৭৫ সেকেন্ড। ক্লায়েন্টের আচরণের উপর ভিত্তি করে এটি সামঞ্জস্য করুন এবং আপনার সাইটে কার্যকলাপের আদর্শ সময়কাল নির্ধারণ করুন:

```bash
keepalive_timeout 65;
```

`keepalive_requests` নির্দেশনাটি নির্দিষ্ট করে যে একটি একক কিপএলাইভ কানেকশন কতগুলি অনুরোধ পরিচালনা করতে পারে, ডিফল্ট মান ১০০। যদি একটি ক্লায়েন্ট দ্রুত অনেক অনুরোধ করে, এই মানটি বৃদ্ধি করুন যাতে অতিরিক্ত TCP হ্যান্ডশেক প্রয়োজন না হয়:

```bash
keepalive_requests 100;
```

### আপস্ট্রিম সার্ভারগুলির সাথে কিপএলাইভ ব্যবহার করা

NGINX এবং আপস্ট্রিম সার্ভারগুলির মধ্যে কানেকশনগুলির জন্য, `upstream` মডিউলের `keepalive` নির্দেশনা ব্যবহার করুন যাতে একটি ক্যাশ করা কানেকশন পুল বজায় থাকে। HTTP সংস্করণটি অন্তত ১.১ এ সেট করুন এবং কানেকশন হেডারটি পরিষ্কার করুন বা আপগ্রেড করুন:

```bash
upstream backend {
    server backend1.example.com;
    keepalive 32;
}
```

```bash
location / {
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_pass <http://backend>;
}
```

আমরা কিভাবে `worker_processes`, `worker_connections`, এবং কিপএলাইভ (keepalives) সামঞ্জস্য করতে পারি তা নিয়ে আলোচনা করেছি। মূল পয়েন্টগুলি হল:

- `worker_processes` কে `auto` এ সেট করুন যাতে সমস্ত CPU কোর ব্যবহার করা যায়।
- একাধিক সমসাময়িক কানেকশন পরিচালনা করতে `worker_connections` বৃদ্ধি করুন।
- কিপএলাইভ কনফিগার করুন যাতে কানেকশনগুলি দীর্ঘ সময় ধরে থাকে, নতুন কানেকশন স্থাপনের ওভারহেড কমায়।
- আপস্ট্রিম সার্ভারের সাথে কিপএলাইভ ব্যবহার করুন যাতে ক্যাশ করা কানেকশন পুল বজায় থাকে এবং কার্যক্ষমতা উন্নত হয়।

এই সেটিংসগুলি  করে, আপনি আপনার NGINX সার্ভারকে আরও কার্যকরভাবে উচ্চ ট্রাফিক পরিচালনার জন্য অপ্টিমাইজ করতে পারেন, এবং কানেকশন ড্রপ এড়াতে পারেন।